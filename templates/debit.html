<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debit Card Application Form</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            padding: 0;
            border: 3px solid #97144d;
        }
        
        .header {
            background: #97144d;
            color: white;
            padding: 20px 30px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .bank-logo {
            font-size: 24px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .form-title-section {
            text-align: center;
            background: white;
            padding: 20px;
            border-bottom: 2px solid #97144d;
        }
        
        .form-title {
            font-size: 26px;
            font-weight: bold;
            color: #97144d;
            margin-bottom: 5px;
        }
        
        .form-subtitle {
            font-size: 12px;
            color: #666;
        }
        
        .content {
            padding: 30px;
        }
        
        .info-note {
            background: #fff3cd;
            border: 1px solid #ffc107;
            padding: 12px;
            margin-bottom: 20px;
            font-size: 12px;
            border-radius: 3px;
        }
        
        .section {
            margin-bottom: 25px;
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 5px;
        }
        
        .section-title {
            background: #97144d;
            color: white;
            padding: 10px 15px;
            margin: -20px -20px 20px -20px;
            font-weight: bold;
            font-size: 14px;
            text-transform: uppercase;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 15px;
        }
        
        .form-row.single {
            grid-template-columns: 1fr;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            font-size: 12px;
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }
        
        .required {
            color: #dc3545;
        }
        
        .form-group input[type="text"],
        .form-group input[type="date"],
        .form-group input[type="number"],
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #999;
            font-size: 13px;
            background: #fff;
            border-radius: 3px;
        }
        
        .box-input-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(35px, 1fr));
            gap: 5px;
            max-width: 600px;
        }
        
        .box-input-group input {
            padding: 10px 5px;
            text-align: center;
            border: 1px solid #999;
            font-size: 14px;
            font-weight: bold;
        }
        
        .radio-group, .checkbox-group {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            margin-top: 8px;
        }
        
        .radio-group label, .checkbox-group label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            font-weight: normal;
            cursor: pointer;
        }
        
        .radio-group input[type="radio"],
        .checkbox-group input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        
        .photo-section {
            border: 2px dashed #999;
            padding: 20px;
            text-align: center;
            min-height: 150px;
            background: #fafafa;
            border-radius: 3px;
        }
        
        .photo-section label {
            display: block;
            margin-bottom: 10px;
            font-weight: bold;
        }
        
        .signature-box {
            border: 2px solid #999;
            min-height: 100px;
            margin-top: 10px;
            border-radius: 3px;
            background: #fafafa;
        }
        
        .declaration-section {
            background: #f9f9f9;
            padding: 15px;
            border: 1px solid #ddd;
            margin-top: 20px;
            font-size: 12px;
            border-radius: 3px;
        }
        
        .office-use {
            margin-top: 30px;
            padding: 20px;
            border: 2px dashed #999;
            text-align: center;
            background: #f0f0f0;
        }
        
        .office-use-title {
            background: #97144d;
            color: white;
            padding: 8px;
            font-weight: bold;
            margin: -20px -20px 15px -20px;
        }
        
        @media print {
            body {
                background: white;
                padding: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="bank-logo">
                <span>▲</span>
                <span>AXIS BANK</span>
            </div>
            <div style="font-size: 12px;">Form Type: DCAF3</div>
        </div>
        
        <!-- Form Title -->
        <div class="form-title-section">
            <div class="form-title">Debit Card Application Form</div>
            <div class="form-subtitle">FOR NRE SAVING BANK ACCOUNTS</div>
            <div class="form-subtitle">(For Power of Attorney / Letter of Authority issue by the NRE Account only)</div>
        </div>
        
        <!-- Content -->
        <div class="content">
            <div class="info-note">
                <strong>Note:</strong> Please fill the form in BLOCK LETTERS only. Fields marked with <span class="required">*</span> (star) are MANDATORY.
                Your Debit Card will be a chip card activated with facility of using it at Domestic ATM and POS merchant outlets within India only.
            </div>
            
            <!-- Account & Personal Details -->
            <div class="section">
                <div class="section-title">Account & Personal Details</div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>NRE A/c Number <span class="required">*</span></label>
                        <input type="text" id="nre_account_number" placeholder="Enter Account Number" maxlength="20">
                    </div>
                    <div class="form-group">
                        <label>Customer Identification Number</label>
                        <input type="text" id="customer_id" placeholder="Customer ID">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>POA / LOA Holder (Power of Attorney / Letter of Authority) <span class="required">*</span></label>
                    <input type="text" id="poa_holder" placeholder="Full Name of POA/LOA Holder">
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Mother's Maiden Name <span class="required">*</span></label>
                        <input type="text" id="mother_maiden_name" placeholder="Mother's Maiden Name">
                    </div>
                    <div class="form-group">
                        <label>Date of Birth of the Applicant <span class="required">*</span></label>
                        <input type="date" id="dob">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Image Card (Select)</label>
                        <div class="radio-group">
                            <label>
                                <input type="radio" name="image_card" id="image_yes" value="yes">
                                Yes
                            </label>
                            <label>
                                <input type="radio" name="image_card" id="image_no" value="no" checked>
                                No
                            </label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Desired Image Code (if applicable)</label>
                        <input type="text" id="image_code" placeholder="Image Code">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Name as desired on the Card <span class="required">*</span></label>
                    <input type="text" id="card_name" placeholder="Maximum up to 18 characters, should not be a nickname" maxlength="18">
                    <div style="font-size: 11px; color: #666; margin-top: 5px;">Maximum up to 18 characters, should not be a nickname.</div>
                </div>
            </div>
            
            <!-- Reason for Issuance -->
            <div class="section">
                <div class="section-title">Reason for Issuance</div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Card Type <span class="required">*</span></label>
                        <div class="checkbox-group">
                            <label>
                                <input type="checkbox" id="new_card" value="new">
                                New Card
                            </label>
                            <label>
                                <input type="checkbox" id="lost_card" value="lost">
                                Lost Card
                            </label>
                            <label>
                                <input type="checkbox" id="damaged_card" value="damaged">
                                Damaged Card
                            </label>
                            <label>
                                <input type="checkbox" id="others_card" value="others">
                                Others
                            </label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Application Type</label>
                        <div class="radio-group">
                            <label>
                                <input type="radio" name="application_type" id="first_app" value="first" checked>
                                First
                            </label>
                            <label>
                                <input type="radio" name="application_type" id="joint_app" value="joint">
                                Joint
                            </label>
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Cross Self ID (if applicable)</label>
                        <input type="text" id="cross_self_id" placeholder="Cross Self ID">
                    </div>
                    <div class="form-group">
                        <label>BIN Number (if applicable)</label>
                        <input type="text" id="bin_number" placeholder="BIN Number">
                    </div>
                </div>
            </div>
            
            <!-- Photo & Signature -->
            <div class="section">
                <div class="section-title">POA / LOA Holder Photo & Signature</div>
                
                <div class="form-row">
                    <div class="form-group">
                        <div class="photo-section">
                            <label>POA / LOA Holder</label>
                            <div style="color: #666; font-size: 12px;">Please paste<br>Passport Size colour<br>Photograph here</div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Signature of POA / LOA (Please Sign in Black)</label>
                        <div class="signature-box"></div>
                        <input type="text" id="poa_signature_name" placeholder="Name" style="margin-top: 10px;">
                    </div>
                </div>
            </div>
            
            <!-- Verifying Authority -->
            <div class="section">
                <div class="section-title">Verifying Authority Details</div>
                
                <div class="form-group">
                    <label>Name of the Verifying Authority</label>
                    <input type="text" id="verifying_authority_name" placeholder="Full Name">
                </div>
                
                <div class="form-group">
                    <label>S.S. Number (Social Security Number)</label>
                    <input type="text" id="ss_number" placeholder="SS Number">
                </div>
                
                <div class="form-group">
                    <label>Signature of the Verifying Authority</label>
                    <div class="signature-box"></div>
                </div>
            </div>
            
            <!-- Declaration -->
            <div class="declaration-section">
                <div style="background: #97144d; color: white; padding: 8px; margin: -15px -15px 15px -15px; font-weight: bold; text-align: center;">
                    Declaration / Debit Card Undertaking
                </div>
                
                <div class="form-group">
                    <label>Signature of Account Holder</label>
                    <div class="signature-box"></div>
                    <input type="text" id="account_holder_name" placeholder="Name" style="margin-top: 10px;">
                </div>
                
                <div style="margin-top: 15px; font-size: 11px; line-height: 1.6;">
                    <strong>Declaration:</strong> I confirm that I am the Power of Attorney / Letter of Authority holder to the above NRE Account who is authorized to operate the Domestic Debit Card. I shall hold the Bank indemnified against all the claims that may arise out of my using Domestic Card.
                </div>
            </div>
            
            <!-- For Office Use -->
            <div class="office-use">
                <div class="office-use-title">For Office Use</div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Branch Name</label>
                        <input type="text" id="office_branch_name" placeholder="Branch Name">
                    </div>
                    <div class="form-group">
                        <label>Branch Code</label>
                        <input type="text" id="office_branch_code" placeholder="Branch Code">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Date</label>
                    <input type="date" id="office_date">
                </div>
                
                <div style="margin-top: 20px; padding: 15px; background: white; border: 1px solid #ccc; min-height: 80px;">
                    <div style="font-size: 11px; color: #666;">Signature of customer and Mode of Operation of the Account(s) verified, charges levied (for third card / replacement card only) and hereby authorized to issue the Debit Card.</div>
                </div>
            </div>
            
            <div style="margin-top: 20px; padding: 15px; background: #f9f9f9; border: 1px solid #ddd; font-size: 11px;">
                <strong>Note:</strong> This form is processed through automated system. Please ensure that all mandatory fields have been filled correctly else the form is liable to be rejected.
            </div>
        </div>
    </div>

    <script>
        // Auto-fill form from data collected by assistant
        window.addEventListener('load', function() {
            const rawData = localStorage.getItem('debitCardData');
            console.log('Raw data from localStorage:', rawData);
            
            if (!rawData) {
                console.log('No debit card data found in localStorage');
                return;
            }
            
            let formData = JSON.parse(rawData);
            console.log('Parsed form data:', formData);
            
            if (Object.keys(formData).length > 0) {
                console.log('Filling debit card form with data...');
                fillFormFields(formData);
                localStorage.removeItem('debitCardData');
            } else {
                console.log('Form data is empty');
            }
        });

        function fillFormFields(data) {
            console.log('Starting to fill form with data:', data);
            
            // Helper function to safely set field value
            function setFieldValue(fieldId, value) {
                const field = document.getElementById(fieldId);
                if (field && value !== undefined && value !== null && value !== '') {
                    field.value = value;
                    console.log(`✓ Set ${fieldId} = ${value}`);
                    return true;
                } else if (!field) {
                    console.warn(`✗ Field not found: ${fieldId}`);
                } else {
                    console.log(`- Skipped ${fieldId} (no value: ${value})`);
                }
                return false;
            }

            // Helper function to check radio button
            function checkRadio(name, value) {
                const radio = document.querySelector(`input[name="${name}"][value="${value}"]`);
                if (radio) {
                    radio.checked = true;
                    console.log(`✓ Checked radio ${name} = ${value}`);
                } else {
                    console.warn(`✗ Radio button not found: ${name} = ${value}`);
                }
            }

            // Helper function to check checkboxes
            function checkCheckbox(id, checked) {
                const checkbox = document.getElementById(id);
                if (checkbox && checked) {
                    checkbox.checked = true;
                    console.log(`✓ Checked ${id}`);
                }
            }

            // Helper function to convert date to YYYY-MM-DD format
            function convertDateFormat(dateStr) {
                if (!dateStr) return '';
                
                // If already in YYYY-MM-DD format, return as is
                if (/^\d{4}-\d{2}-\d{2}$/.test(dateStr)) {
                    return dateStr;
                }
                
                // Handle DD/MM/YYYY format
                if (/^\d{2}\/\d{2}\/\d{4}$/.test(dateStr)) {
                    const parts = dateStr.split('/');
                    return `${parts[2]}-${parts[1]}-${parts[0]}`; // Convert to YYYY-MM-DD
                }
                
                // Handle other formats
                try {
                    const date = new Date(dateStr);
                    if (!isNaN(date.getTime())) {
                        const year = date.getFullYear();
                        const month = String(date.getMonth() + 1).padStart(2, '0');
                        const day = String(date.getDate()).padStart(2, '0');
                        return `${year}-${month}-${day}`;
                    }
                } catch (e) {
                    console.error('Date conversion error:', e);
                }
                
                return dateStr;
            }

            // Account & Personal Details
            setFieldValue('nre_account_number', data.nre_account_number || data.account_number);
            setFieldValue('customer_id', data.customer_id || data.customer_identification_number);
            setFieldValue('poa_holder', data.poa_holder || data.poa_loa_holder);
            setFieldValue('mother_maiden_name', data.mother_maiden_name);
            
            // Convert and set date of birth
            const dobValue = data.dob || data.date_of_birth;
            if (dobValue) {
                const convertedDob = convertDateFormat(dobValue);
                console.log(`DOB conversion: "${dobValue}" → "${convertedDob}"`);
                setFieldValue('dob', convertedDob);
            }
            
            // Image card selection
            if (data.image_card) {
                const imageValue = data.image_card.toString().toLowerCase();
                checkRadio('image_card', imageValue);
            }
            setFieldValue('image_code', data.image_code || data.desired_image_code);
            setFieldValue('card_name', data.card_name || data.name_on_card);
            
            // Reason for Issuance - handle multiple card types
            if (data.card_type) {
                const cardTypes = data.card_type.split(',');
                cardTypes.forEach(type => {
                    const trimmed = type.trim().toLowerCase();
                    if (trimmed.includes('new')) checkCheckbox('new_card', true);
                    else if (trimmed.includes('lost')) checkCheckbox('lost_card', true);
                    else if (trimmed.includes('damaged')) checkCheckbox('damaged_card', true);
                    else if (trimmed.includes('other')) checkCheckbox('others_card', true);
                });
            }
            
            // Application type
            if (data.application_type) {
                const appType = data.application_type.toString().toLowerCase();
                checkRadio('application_type', appType);
            }
            
            setFieldValue('cross_self_id', data.cross_self_id);
            setFieldValue('bin_number', data.bin_number);
            
            // POA/LOA Signature
            setFieldValue('poa_signature_name', data.poa_signature_name || data.poa_holder);
            
            // Account holder name for declaration
            setFieldValue('account_holder_name', data.account_holder_name);
            
            console.log('✓ Form filling complete');
            
            // Trigger print dialog after a short delay
            setTimeout(() => {
                window.print();
            }, 500);
        }
    </script>
</body>
</html>