<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bank Account Opening Form</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border: 3px solid #1e3a8a;
        }
        
        .bank-logo {
            text-align: center;
            margin-bottom: 10px;
        }
        
        .bank-name {
            font-size: 28px;
            font-weight: bold;
            color: #1e3a8a;
            font-family: 'Arial Black', sans-serif;
        }
        
        .form-header {
            text-align: center;
            border: 3px solid #000;
            padding: 15px;
            margin-bottom: 25px;
            background: #fff;
        }
        
        .form-title {
            font-size: 24px;
            font-weight: bold;
        }
        
        .header-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .section {
            margin-bottom: 25px;
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 5px;
        }
        
        .section-title {
            background: #1e3a8a;
            color: white;
            padding: 10px 15px;
            margin: -20px -20px 20px -20px;
            font-weight: bold;
            font-size: 14px;
            text-transform: uppercase;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 15px;
        }
        
        .form-row.single {
            grid-template-columns: 1fr;
        }
        
        .form-row.triple {
            grid-template-columns: 1fr 1fr 1fr;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            font-size: 12px;
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }
        
        .form-group input[type="text"],
        .form-group input[type="email"],
        .form-group input[type="tel"],
        .form-group input[type="date"],
        .form-group input[type="number"],
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #999;
            font-size: 13px;
            background: #fff;
            border-radius: 3px;
        }
        
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #999;
            font-size: 13px;
            resize: vertical;
            min-height: 70px;
            border-radius: 3px;
        }
        
        .radio-group, .checkbox-group {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            margin-top: 8px;
        }
        
        .radio-group label, .checkbox-group label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            font-weight: normal;
            cursor: pointer;
        }
        
        .radio-group input[type="radio"],
        .checkbox-group input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        
        .name-inputs {
            display: grid;
            grid-template-columns: 80px 80px 1fr 80px;
            gap: 10px;
        }
        
        @media print {
            body {
                background: white;
                padding: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Bank Logo & Title -->
        <div class="bank-logo">
            <div class="bank-name">STATE BANK OF INDIA</div>
        </div>
        
        <div class="form-header">
            <div class="form-title">Bank Account Opening Form</div>
        </div>
        
        <!-- Header Information -->
        <div class="header-info">
            <div class="form-group">
                <label>Branch</label>
                <input type="text" id="branch" placeholder="Branch Name">
            </div>
            <div class="form-group">
                <label>Date</label>
                <input type="date" id="form_date">
            </div>
        </div>
        
        <!-- Account Opening Application -->
        <div class="section">
            <div class="section-title">Account Type Selection</div>
            
            <div class="form-row">
                <div class="form-group">
                    <label>Account Type</label>
                    <div class="radio-group">
                        <label>
                            <input type="radio" name="account_type" id="savings" value="savings" checked>
                            Savings Account
                        </label>
                        <label>
                            <input type="radio" name="account_type" id="current" value="current">
                            Current Account
                        </label>
                        <label>
                            <input type="radio" name="account_type" id="salary" value="salary">
                            Salary Account
                        </label>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Debit Card Required</label>
                    <div class="radio-group">
                        <label>
                            <input type="radio" name="debit_card" id="card_required" value="yes" checked>
                            Yes
                        </label>
                        <label>
                            <input type="radio" name="debit_card" id="card_not_required" value="no">
                            No
                        </label>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Personal Details -->
        <div class="section">
            <div class="section-title">Personal Details</div>
            
            <div class="form-group">
                <label>Title & Full Name</label>
                <div class="name-inputs">
                    <input type="text" id="title" placeholder="Title" style="width: 80px;">
                    <input type="text" id="first_name" placeholder="First">
                    <input type="text" id="middle_name" placeholder="Middle">
                    <input type="text" id="last_name" placeholder="Last">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label>Date of Birth (DD/MM/YYYY)</label>
                    <input type="date" id="dob">
                </div>
                <div class="form-group">
                    <label>Place of Birth</label>
                    <input type="text" id="place_of_birth" placeholder="City, State">
                </div>
            </div>
            
            <div class="form-group">
                <label>Nationality</label>
                <input type="text" id="nationality" placeholder="Indian" value="Indian">
            </div>
            
            <div class="form-group">
                <label>Identity Document Type</label>
                <div class="radio-group">
                    <label>
                        <input type="radio" name="document_type" id="aadhaar" value="aadhaar" checked>
                        Aadhaar Card
                    </label>
                    <label>
                        <input type="radio" name="document_type" id="passport" value="passport">
                        Passport
                    </label>
                    <label>
                        <input type="radio" name="document_type" id="voter_id" value="voter">
                        Voter ID
                    </label>
                    <label>
                        <input type="radio" name="document_type" id="driving_license" value="driving">
                        Driving License
                    </label>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label>Aadhaar Number</label>
                    <input type="text" id="aadhaar_number" placeholder="XXXX XXXX XXXX" maxlength="14">
                </div>
                <div class="form-group">
                    <label>PAN Number</label>
                    <input type="text" id="pan_number" placeholder="ABCDE1234F" maxlength="10" style="text-transform: uppercase;">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label>Selected Document Number</label>
                    <input type="text" id="document_number" placeholder="ID/Passport/DL/Voter ID Number">
                </div>
                <div class="form-group">
                    <label>Document Expiry Date (if applicable)</label>
                    <input type="date" id="expiry_date">
                </div>
            </div>
        </div>
        
        <!-- Contact Details -->
        <div class="section">
            <div class="section-title">Contact Details</div>
            
            <div class="form-group">
                <label>Residential Address</label>
                <textarea id="address" placeholder="House/Flat No., Building Name, Street/Area"></textarea>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label>City</label>
                    <input type="text" id="city" placeholder="City">
                </div>
                <div class="form-group">
                    <label>State</label>
                    <select id="state">
                        <option value="">Select State</option>
                        <option value="Andhra Pradesh">Andhra Pradesh</option>
                        <option value="Tamil Nadu">Tamil Nadu</option>
                        <option value="Karnataka">Karnataka</option>
                        <option value="Kerala">Kerala</option>
                        <option value="Maharashtra">Maharashtra</option>
                        <option value="Gujarat">Gujarat</option>
                        <option value="Rajasthan">Rajasthan</option>
                        <option value="Delhi">Delhi</option>
                        <option value="West Bengal">West Bengal</option>
                        <option value="Uttar Pradesh">Uttar Pradesh</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
            </div>
            
            <div class="form-group">
                <label>PIN Code</label>
                <input type="text" id="pin_code" placeholder="6-digit PIN Code" maxlength="6">
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label>Mobile Phone</label>
                    <input type="tel" id="mobile_phone" placeholder="+91 XXXXX XXXXX" maxlength="15">
                </div>
                <div class="form-group">
                    <label>Email Address</label>
                    <input type="email" id="email" placeholder="name@example.com">
                </div>
            </div>
        </div>
        
        <!-- Employment Details -->
        <div class="section">
            <div class="section-title">Employment Details</div>
            
            <div class="form-group">
                <label>Employer/Company Name</label>
                <input type="text" id="employer" placeholder="Company Name">
            </div>
            
            <div class="form-group">
                <label>Position/Designation</label>
                <input type="text" id="position_title" placeholder="Your Job Title">
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label>Monthly Gross Salary (₹)</label>
                    <input type="number" id="monthly_salary" placeholder="0">
                </div>
                <div class="form-group">
                    <label>Are you Self-Employed?</label>
                    <div class="radio-group">
                        <label>
                            <input type="radio" name="self_employed" id="self_employed_yes" value="yes">
                            Yes
                        </label>
                        <label>
                            <input type="radio" name="self_employed" id="self_employed_no" value="no" checked>
                            No
                        </label>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Additional Information -->
        <div class="section">
            <div class="section-title">Additional Information</div>
            
            <div class="form-row">
                <div class="form-group">
                    <label>Marital Status</label>
                    <div class="radio-group">
                        <label>
                            <input type="radio" name="marital_status" id="single" value="single">
                            Single
                        </label>
                        <label>
                            <input type="radio" name="marital_status" id="married" value="married">
                            Married
                        </label>
                        <label>
                            <input type="radio" name="marital_status" id="divorced" value="divorced">
                            Divorced
                        </label>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Number of Dependents</label>
                    <input type="number" id="num_dependents" placeholder="0" min="0">
                </div>
            </div>
            
            <div class="form-group">
                <label>Purpose of Account Opening</label>
                <div class="checkbox-group">
                    <label>
                        <input type="checkbox" id="salary_credit" value="salary">
                        Salary Credit
                    </label>
                    <label>
                        <input type="checkbox" id="savings_purpose" value="savings">
                        Savings
                    </label>
                    <label>
                        <input type="checkbox" id="business_transactions" value="business">
                        Business Transactions
                    </label>
                    <label>
                        <input type="checkbox" id="investments" value="investments">
                        Investments
                    </label>
                    <label>
                        <input type="checkbox" id="other_purpose" value="other">
                        Others
                    </label>
                </div>
                <input type="text" id="other_purpose_text" placeholder="If others, please specify" style="margin-top: 10px;">
            </div>
        </div>
        
        <!-- Debit Card Delivery -->
        <div class="section">
            <div class="section-title">Debit Card Delivery</div>
            
            <div class="form-group">
                <label>Delivery Method</label>
                <div class="radio-group">
                    <label>
                        <input type="radio" name="card_delivery" id="branch_pickup" value="branch" checked>
                        Collect from Branch
                    </label>
                    <label>
                        <input type="radio" name="card_delivery" id="home_delivery" value="home">
                        Home Delivery
                    </label>
                </div>
            </div>
        </div>
        
        <!-- Signature Section -->
        <div class="section">
            <div class="form-row">
                <div class="form-group">
                    <label>Date</label>
                    <input type="date" id="signature_date">
                </div>
                <div class="form-group">
                    <label>Place</label>
                    <input type="text" id="signature_place" placeholder="City">
                </div>
            </div>
            
            <div class="form-group" style="margin-top: 20px;">
                <label>Applicant's Signature</label>
                <div style="border: 2px solid #999; min-height: 100px; margin-top: 10px; border-radius: 3px; background: #fafafa;"></div>
            </div>
            
            <div style="margin-top: 30px; padding: 20px; border: 2px dashed #999; text-align: center; background: #f9f9f9;">
                <div style="font-weight: bold; font-size: 16px; margin-bottom: 10px;">FOR BANK USE ONLY</div>
                <div style="min-height: 80px;"></div>
            </div>
        </div>
    </div>

    <script>
        // Auto-fill form from data collected by assistant
        window.addEventListener('load', function() {
            // Auto-fill form date with current date
            const today = new Date();
            const formattedDate = today.toISOString().split('T')[0];
            const formDateField = document.getElementById('form_date');
            if (formDateField) {
                formDateField.value = formattedDate;
            }
            
            const rawData = localStorage.getItem('accountOpeningData');
            console.log('Raw data from localStorage:', rawData);
            
            if (!rawData) {
                console.log('No account opening data found in localStorage');
                return;
            }
            
            let formData = JSON.parse(rawData);
            console.log('Parsed form data:', formData);
            
            if (Object.keys(formData).length > 0) {
                console.log('Filling account opening form with data...');
                fillFormFields(formData);
                localStorage.removeItem('accountOpeningData');
            } else {
                console.log('Form data is empty');
            }
        });

        function fillFormFields(data) {
            console.log('Starting to fill form with data:', data);
            
            // Helper function to safely set field value
            function setFieldValue(fieldId, value) {
                const field = document.getElementById(fieldId);
                if (field && value !== undefined && value !== null && value !== '') {
                    field.value = value;
                    console.log(`✓ Set ${fieldId} = ${value}`);
                    return true;
                } else if (!field) {
                    console.warn(`✗ Field not found: ${fieldId}`);
                } else {
                    console.log(`- Skipped ${fieldId} (no value: ${value})`);
                }
                return false;
            }

            // Helper function to check radio button
            function checkRadio(name, value) {
                const radio = document.querySelector(`input[name="${name}"][value="${value}"]`);
                if (radio) {
                    radio.checked = true;
                    console.log(`✓ Checked radio ${name} = ${value}`);
                }
            }

            // Helper function to check checkboxes
            function checkCheckbox(id, checked) {
                const checkbox = document.getElementById(id);
                if (checkbox && checked) {
                    checkbox.checked = true;
                    console.log(`✓ Checked ${id}`);
                }
            }

            // Fill basic account information
            setFieldValue('branch', data.branch);
            // form_date is auto-filled on page load
            
            // Account type and debit card
            if (data.account_type) checkRadio('account_type', data.account_type);
            if (data.debit_card) checkRadio('debit_card', data.debit_card);
            
            // Personal information
            setFieldValue('title', data.title);
            setFieldValue('first_name', data.first_name);
            setFieldValue('middle_name', data.middle_name);
            setFieldValue('last_name', data.last_name);
            setFieldValue('dob', data.dob);
            setFieldValue('place_of_birth', data.place_of_birth);
            setFieldValue('nationality', data.nationality || 'Indian');
            
            // Documents - handle all document field variations
            if (data.document_type) checkRadio('document_type', data.document_type);
            
            // Try multiple field name variations for aadhaar
            const aadhaarValue = data.aadhaar_number || data.aadhaar || data.aadhaar_no;
            if (aadhaarValue) {
                console.log('Aadhaar value found:', aadhaarValue);
                setFieldValue('aadhaar_number', aadhaarValue);
            }
            
            setFieldValue('pan_number', data.pan_number || data.pan);
            setFieldValue('document_number', data.document_number || data.selected_document_number);
            setFieldValue('expiry_date', data.expiry_date || data.document_expiry_date);
            
            // Contact details - handle all variations
            setFieldValue('address', data.address || data.residential_address);
            setFieldValue('city', data.city);
            
            // State dropdown - ensure value is set
            if (data.state) {
                console.log('State value found:', data.state);
                setFieldValue('state', data.state);
            }
            
            setFieldValue('pin_code', data.pin_code || data.postal_code);
            setFieldValue('mobile_phone', data.mobile_phone || data.mobile);
            setFieldValue('email', data.email || data.email_address);
            
            // Employment details
            setFieldValue('employer', data.employer || data.employer_name);
            setFieldValue('position_title', data.position_title || data.position || data.designation);
            setFieldValue('monthly_salary', data.monthly_salary || data.monthly_gross_salary);
            if (data.self_employed) checkRadio('self_employed', data.self_employed);
            
            // Additional information - handle marital status properly
            if (data.marital_status) {
                console.log('Marital status raw value:', data.marital_status);
                const maritalValue = data.marital_status.toString().toLowerCase().trim();
                console.log('Marital status normalized:', maritalValue);
                checkRadio('marital_status', maritalValue);
            }
            setFieldValue('num_dependents', data.num_dependents || data.number_of_dependents);
            
            // Purpose of account (can be multiple comma-separated values)
            if (data.purpose) {
                const purposes = data.purpose.split(',');
                purposes.forEach(purpose => {
                    const trimmed = purpose.trim();
                    if (trimmed === 'salary') checkCheckbox('salary_credit', true);
                    else if (trimmed === 'savings') checkCheckbox('savings_purpose', true);
                    else if (trimmed === 'business') checkCheckbox('business_transactions', true);
                    else if (trimmed === 'investments') checkCheckbox('investments', true);
                    else if (trimmed === 'other') checkCheckbox('other_purpose', true);
                });
            }
            setFieldValue('other_purpose_text', data.other_purpose_text);
            
            // Card delivery
            if (data.card_delivery) checkRadio('card_delivery', data.card_delivery);
            
            // Signature section - auto-fill with current date and city if not provided
            const today = new Date().toISOString().split('T')[0];
            setFieldValue('signature_date', data.signature_date || today);
            
            // Use city or place_of_birth as fallback for signature place
            const signaturePlace = data.signature_place || data.city || data.place_of_birth || '';
            if (signaturePlace) {
                console.log('Setting signature_place:', signaturePlace);
                setFieldValue('signature_place', signaturePlace);
            }
            
            console.log('✓ Form filling complete');
            
            // Trigger print dialog after a short delay
            setTimeout(() => {
                window.print();
            }, 500);
        }

        // Print button handler
        function printForm() {
            window.print();
        }
    </script>
</body>
</html>